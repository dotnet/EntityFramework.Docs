<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core Application to Existing Database (Database First) </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core Application to Existing Database (Database First) ">
    <meta name="generator" content="docfx 2.5.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="platforms/aspnetcore/existing-db">
              <h1 id="aspnet-core-application-to-existing-database-database-first" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="4" sourceendlinenumber="4">ASP.NET Core Application to Existing Database (Database First)</h1>
              
<div class="WARNING sourceFile=" platforms/aspnetcore/existing-db.md"="" sourcestartlinenumber="6" sourceendlinenumber="6" "=""><h5>Warning</h5><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="7" sourceendlinenumber="7">This documentation is for EF Core. For EF6.x and earlier release see <a href="http://msdn.com/data/ef" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="7" sourceendlinenumber="7"><a href="http://msdn.com/data/ef" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="7" sourceendlinenumber="7">http://msdn.com/data/ef</a></a>.</p>
</div>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="9" sourceendlinenumber="9">In this walkthrough, you will build an ASP.NET Core MVC application that performs basic data access using Entity Framework.  You will use reverse engineering to create an Entity Framework model based on an existing database.</p>
<div class="TIP sourceFile=" platforms/aspnetcore/existing-db.md"="" sourcestartlinenumber="11" sourceendlinenumber="11" "=""><h5>Tip</h5><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="12" sourceendlinenumber="12">You can view this article&#39;s <a href="https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/Platforms/AspNetCore/AspNetCore.ExistingDb" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="12" sourceendlinenumber="12">sample</a> on GitHub.</p>
</div>
<h2 id="prerequisites" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="14" sourceendlinenumber="14">Prerequisites</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="16" sourceendlinenumber="16">The following prerequisites are needed to complete this walkthrough:</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="18" sourceendlinenumber="22">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="18" sourceendlinenumber="18"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="18" sourceendlinenumber="18"><a href="https://go.microsoft.com/fwlink/?LinkId=691129" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="18" sourceendlinenumber="18">Visual Studio 2015 Update 3</a></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="20" sourceendlinenumber="20"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="20" sourceendlinenumber="20"><a href="https://go.microsoft.com/fwlink/?LinkId=817245" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="20" sourceendlinenumber="20">.NET Core for Visual Studio</a></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="22" sourceendlinenumber="22"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="22" sourceendlinenumber="22"><a href="#blogging-database" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="22" sourceendlinenumber="22">Blogging database</a></p>
</li>
</ul>
<h3 id="blogging-database" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="24" sourceendlinenumber="24">Blogging database</h3>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="26" sourceendlinenumber="26">This tutorial uses a <strong>Blogging</strong> database on your LocalDb instance as the existing database.</p>
<div class="NOTE sourceFile=" platforms/aspnetcore/existing-db.md"="" sourcestartlinenumber="28" sourceendlinenumber="28" "=""><h5>Note</h5><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="29" sourceendlinenumber="29">If you have already created the <strong>Blogging</strong> database as part of another tutorial, you can skip these steps.</p>
</div>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="31" sourceendlinenumber="47">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="31" sourceendlinenumber="31"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="31" sourceendlinenumber="31">Open Visual Studio</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="33" sourceendlinenumber="33"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="33" sourceendlinenumber="33">Tools ‣ Connect to Database...</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="35" sourceendlinenumber="35"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="35" sourceendlinenumber="35">Select <strong>Microsoft SQL Server</strong> and click <strong>Continue</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="37" sourceendlinenumber="37"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="37" sourceendlinenumber="37">Enter <strong>(localdb)\mssqllocaldb</strong> as the <strong>Server Name</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="39" sourceendlinenumber="39"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="39" sourceendlinenumber="39">Enter <strong>master</strong> as the <strong>Database Name</strong> and click <strong>OK</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="41" sourceendlinenumber="41"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="41" sourceendlinenumber="41">The master database is now displayed under <strong>Data Connections</strong> in <strong>Server Explorer</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="43" sourceendlinenumber="43"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="43" sourceendlinenumber="43">Right-click on the database in <strong>Server Explorer</strong> and select <strong>New Query</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="45" sourceendlinenumber="45"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="45" sourceendlinenumber="45">Copy the script, listed below, into the query editor</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="47" sourceendlinenumber="47"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="47" sourceendlinenumber="47">Right-click on the query editor and select <strong>Execute</strong></p>
</li>
</ul>
<!-- [!code-sql[Main](platforms/_shared/create-blogging-database-script.sql)] Note: This file does not seem to exist -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="50" sourceendlinenumber="79"><code class="lang-sql">CREATE DATABASE [Blogging]
GO

USE [Blogging]
GO

CREATE TABLE [Blog] (
    [BlogId] int NOT NULL IDENTITY,
    [Url] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Blog] PRIMARY KEY ([BlogId])
);
GO

CREATE TABLE [Post] (
    [PostId] int NOT NULL IDENTITY,
    [BlogId] int NOT NULL,
    [Content] nvarchar(max),
    [Title] nvarchar(max),
    CONSTRAINT [PK_Post] PRIMARY KEY ([PostId]),
    CONSTRAINT [FK_Post_Blog_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [Blog] ([BlogId]) ON DELETE CASCADE
);
GO

INSERT INTO [Blog] (Url) VALUES 
(&#39;http://blogs.msdn.com/dotnet&#39;), 
(&#39;http://blogs.msdn.com/webdev&#39;), 
(&#39;http://blogs.msdn.com/visualstudio&#39;)
GO
</code></pre><h2 id="create-a-new-project" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="81" sourceendlinenumber="81">Create a new project</h2>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="83" sourceendlinenumber="97">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="83" sourceendlinenumber="83"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="83" sourceendlinenumber="83">Open Visual Studio 2015</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="85" sourceendlinenumber="85"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="85" sourceendlinenumber="85">File ‣ New ‣ Project...</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="87" sourceendlinenumber="87"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="87" sourceendlinenumber="87">From the left menu select Templates ‣ Visual C# ‣ Web</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="89" sourceendlinenumber="89"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="89" sourceendlinenumber="89">Select the <strong>ASP.NET Core Web Application (.NET Core)</strong> project template</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="91" sourceendlinenumber="91"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="91" sourceendlinenumber="91">Enter <strong>EFGetStarted.AspNetCore.ExistingDb</strong> as the name and click <strong>OK</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="93" sourceendlinenumber="93"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="93" sourceendlinenumber="93">Wait for the <strong>New ASP.NET Core Web Application</strong> dialog to appear</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="95" sourceendlinenumber="95"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="95" sourceendlinenumber="95">Select the <strong>Web Application</strong> template and ensure that <strong>Authentication</strong> is set to <strong>No Authentication</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="97" sourceendlinenumber="97"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="97" sourceendlinenumber="97">Click <strong>OK</strong></p>
</li>
</ul>
<h2 id="install-entity-framework" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="99" sourceendlinenumber="99">Install Entity Framework</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="101" sourceendlinenumber="101">To use EF Core, install the package for the database provider(s) you want to target. This walkthrough uses SQL Server. For a list of available providers see <a href="../../providers/index.html" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="101" sourceendlinenumber="101">Database Providers</a>.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="103" sourceendlinenumber="105">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="103" sourceendlinenumber="103"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="103" sourceendlinenumber="103">Tools ‣ NuGet Package Manager ‣ Package Manager Console</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="105" sourceendlinenumber="105"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="105" sourceendlinenumber="105">Run <code>Install-Package Microsoft.EntityFrameworkCore.SqlServer</code></p>
</li>
</ul>
<div class="NOTE sourceFile=" platforms/aspnetcore/existing-db.md"="" sourcestartlinenumber="107" sourceendlinenumber="107" "=""><h5>Note</h5><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="108" sourceendlinenumber="108">In ASP.NET Core projects the <code>Install-Package</code> will complete quickly and the package installation will occur in the background. You will see <strong>(Restoring...)</strong> appear next to <strong>References</strong> in <strong>Solution Explorer</strong> while the install occurs.</p>
</div>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="110" sourceendlinenumber="110">To enable reverse engineering from an existing database we need to install a couple of other packages too.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="112" sourceendlinenumber="118">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="112" sourceendlinenumber="112"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="112" sourceendlinenumber="112">Run <code>Install-Package Microsoft.EntityFrameworkCore.Tools –Pre</code></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="114" sourceendlinenumber="114"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="114" sourceendlinenumber="114">Run <code>Install-Package Microsoft.EntityFrameworkCore.SqlServer.Design</code></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="116" sourceendlinenumber="116"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="116" sourceendlinenumber="116">Open <strong>project.json</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="118" sourceendlinenumber="118"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="118" sourceendlinenumber="118">Locate the <code>tools</code> section and add the highlighted lines as shown below</p>
</li>
</ul>
<!-- [!code-json[Main](samples/aspnetcore/Platforms/AspNetCore/AspNetCore.NewDb/project.json?highlight=2)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="121" sourceendlinenumber="127"><code class="lang-json"> &quot;tools&quot;: {
   &quot;Microsoft.EntityFrameworkCore.Tools&quot;: &quot;1.0.0-preview2-final&quot;,
   &quot;Microsoft.AspNetCore.Razor.Tools&quot;: &quot;1.0.0-preview2-final&quot;,
   &quot;Microsoft.AspNetCore.Server.IISIntegration.Tools&quot;: &quot;1.0.0-preview2-final&quot;
 },
</code></pre><h2 id="reverse-engineer-your-model" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="129" sourceendlinenumber="129">Reverse engineer your model</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="131" sourceendlinenumber="131">Now it&#39;s time to create the EF model based on your existing database.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="133" sourceendlinenumber="135">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="133" sourceendlinenumber="133"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="133" sourceendlinenumber="133">Tools –&gt; NuGet Package Manager –&gt; Package Manager Console</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="135" sourceendlinenumber="135"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="135" sourceendlinenumber="135">Run the following command to create a model from the existing database. If you receive an error stating the term &#39;Scaffold-DbContext&#39; is not recognized as the name of a cmdlet, then close and reopen Visual Studio.</p>
</li>
</ul>
<!-- literal_block"language": "csharp",", "xml:space": "preserve", "classes  "backrefs  "names  "dupnames  highlight_args}, "ids  "linenos": false -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="138" sourceendlinenumber="140"><code class="lang-text">Scaffold-DbContext &quot;Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;&quot; Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models
</code></pre><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="142" sourceendlinenumber="142">The reverse engineer process created entity classes and a derived context based on the schema of the existing database. The entity classes are simple C# objects that represent the data you will be querying and saving.</p>
<!-- [!code-csharp[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Models/Blog.cs)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="145" sourceendlinenumber="164"><code class="lang-csharp">using System;
using System.Collections.Generic;

namespace EFGetStarted.AspNetCore.ExistingDb.Models
{
    public partial class Blog
    {
        public Blog()
        {
            Post = new HashSet&lt;Post&gt;();
        }

        public int BlogId { get; set; }
        public string Url { get; set; }

        public virtual ICollection&lt;Post&gt; Post { get; set; }
    }
}
</code></pre><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="166" sourceendlinenumber="166">The context represents a session with the database and allows you to query and save instances of the entity classes.</p>
<!-- [!code[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Models/BloggingContextUnmodified.txt)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="169" sourceendlinenumber="202"><code class="lang-csharp">using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Metadata;

namespace EFGetStarted.AspNetCore.ExistingDb.Models
{
    public partial class BloggingContext : DbContext
    {
        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            #warning To protect potentially sensitive information in your connection string, you should move it out of source code. See http://go.microsoft.com/fwlink/?LinkId=723263 for guidance on storing connection strings.
            optionsBuilder.UseSqlServer(@&quot;Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;&quot;);
        }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity&lt;Blog&gt;(entity =&gt;
            {
                entity.Property(e =&gt; e.Url).IsRequired();
            });

            modelBuilder.Entity&lt;Post&gt;(entity =&gt;
            {
                entity.HasOne(d =&gt; d.Blog)
                    .WithMany(p =&gt; p.Post)
                    .HasForeignKey(d =&gt; d.BlogId);
            });
        }

        public virtual DbSet&lt;Blog&gt; Blog { get; set; }
        public virtual DbSet&lt;Post&gt; Post { get; set; }
    }
}
</code></pre><h2 id="register-your-context-with-dependency-injection" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="204" sourceendlinenumber="204">Register your context with dependency injection</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="206" sourceendlinenumber="206">The concept of dependency injection is central to ASP.NET Core. Services (such as <code>BloggingContext</code>) are registered with dependency injection during application startup. Components that require these services (such as your MVC controllers) are then provided these services via constructor parameters or properties. For more information on dependency injection see the <a href="http://docs.asp.net/en/latest/fundamentals/dependency-injection.html" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="206" sourceendlinenumber="206">Dependency Injection</a> article on the ASP.NET site.</p>
<h3 id="remove-inline-context-configuration" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="208" sourceendlinenumber="208">Remove inline context configuration</h3>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="210" sourceendlinenumber="210">In ASP.NET Core, configuration is generally performed in <strong>Startup.cs</strong>. To conform to this pattern, we will move configuration of the database provider to <strong>Startup.cs</strong>.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="212" sourceendlinenumber="214">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="212" sourceendlinenumber="212"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="212" sourceendlinenumber="212">Open <strong>Models\BloggingContext.cs</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="214" sourceendlinenumber="214"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="214" sourceendlinenumber="214">Delete the lines of code highlighted below</p>
</li>
</ul>
<!-- [!code[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Models/BloggingContextUnmodified.txt?highlight=3,4,5,6,7)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="217" sourceendlinenumber="225"><code class="lang-csharp">public partial class BloggingContext : DbContext
{
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
      #warning To protect potentially sensitive information in your connection string, you should move it out of source code. See http://go.microsoft.com/fwlink/?LinkId=723263 for guidance on storing connection strings.
        optionsBuilder.UseSqlServer(@&quot;Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;&quot;);
    }
</code></pre><ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="227" sourceendlinenumber="227">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="227" sourceendlinenumber="227">Add the lines of code highlighted below</li>
</ul>
<!-- [!code-csharp[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Models/BloggingContext.cs?highlight=3,4,5)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="230" sourceendlinenumber="236"><code class="lang-csharp">public partial class BloggingContext : DbContext
{
    public BloggingContext(DbContextOptions&lt;BloggingContext&gt; options)
        : base(options)
    { }
</code></pre><h3 id="register-and-configure-your-context-in-startupcs" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="238" sourceendlinenumber="238">Register and configure your context in Startup.cs</h3>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="240" sourceendlinenumber="240">In order for our MVC controllers to make use of <code>BloggingContext</code> we are going to register it as a service.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="242" sourceendlinenumber="244">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="242" sourceendlinenumber="242"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="242" sourceendlinenumber="242">Open <strong>Startup.cs</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="244" sourceendlinenumber="244"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="244" sourceendlinenumber="244">Add the following <code>using</code> statements at the start of the file</p>
</li>
</ul>
<!-- [!code-csharp[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Startup.cs)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="247" sourceendlinenumber="250"><code class="lang-csharp">using EFGetStarted.AspNetCore.ExistingDb.Models;
using Microsoft.EntityFrameworkCore;
</code></pre><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="252" sourceendlinenumber="252">Now we can use the <code>AddDbContext</code> method to register it as a service.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="254" sourceendlinenumber="256">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="254" sourceendlinenumber="254"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="254" sourceendlinenumber="254">Locate the <code>ConfigureServices</code> method</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="256" sourceendlinenumber="256"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="256" sourceendlinenumber="256">Add the lines that are highlighted in the following code</p>
</li>
</ul>
<!-- [!code-csharp[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Startup.cs?highlight=3,4)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="259" sourceendlinenumber="264"><code class="lang-csharp">public void ConfigureServices(IServiceCollection services)
{
    var connection = @&quot;Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;&quot;;
    services.AddDbContext&lt;BloggingContext&gt;(options =&gt; options.UseSqlServer(connection));
</code></pre><h2 id="create-a-controller" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="266" sourceendlinenumber="266">Create a controller</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="268" sourceendlinenumber="268">Next, we&#39;ll add an MVC controller that will use EF to query and save data.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="270" sourceendlinenumber="278">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="270" sourceendlinenumber="270"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="270" sourceendlinenumber="270">Right-click on the <strong>Controllers</strong> folder in <strong>Solution Explorer</strong> and select Add ‣ New Item...</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="272" sourceendlinenumber="272"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="272" sourceendlinenumber="272">From the left menu select Installed ‣ Code</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="274" sourceendlinenumber="274"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="274" sourceendlinenumber="274">Select the <strong>Class</strong> item template</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="276" sourceendlinenumber="276"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="276" sourceendlinenumber="276">Enter <strong>BlogsController.cs</strong> as the name and click <strong>OK</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="278" sourceendlinenumber="278"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="278" sourceendlinenumber="278">Replace the contents of the file with the following code</p>
</li>
</ul>
<!-- [!code-csharp[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Controllers/BlogsController.cs)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="281" sourceendlinenumber="323"><code class="lang-csharp">using EFGetStarted.AspNetCore.ExistingDb.Models;
using Microsoft.AspNetCore.Mvc;
using System.Linq;

namespace EFGetStarted.AspNetCore.ExistingDb.Controllers
{
    public class BlogsController : Controller
    {
        private BloggingContext _context;

        public BlogsController(BloggingContext context)
        {
            _context = context;
        }

        public IActionResult Index()
        {
            return View(_context.Blog.ToList());
        }

        public IActionResult Create()
        {
            return View();
        }

        [HttpPost]
        [ValidateAntiForgeryToken]
        public IActionResult Create(Blog blog)
        {
            if (ModelState.IsValid)
            {
                _context.Blog.Add(blog);
                _context.SaveChanges();
                return RedirectToAction(&quot;Index&quot;);
            }

            return View(blog);
        }

    }
}
</code></pre><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="325" sourceendlinenumber="325">You&#39;ll notice that the controller takes a <code>BloggingContext</code> as a constructor parameter. ASP.NET dependency injection will take care of passing an instance of <code>BloggingContext</code> into your controller.</p>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="327" sourceendlinenumber="327">The controller contains an <code>Index</code> action, which displays all blogs in the database, and a <code>Create</code> action, which inserts a new blogs into the database.</p>
<h2 id="create-views" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="329" sourceendlinenumber="329">Create views</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="331" sourceendlinenumber="331">Now that we have a controller it&#39;s time to add the views that will make up the user interface.</p>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="333" sourceendlinenumber="333">We&#39;ll start with the view for our <code>Index</code> action, that displays all blogs.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="335" sourceendlinenumber="347">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="335" sourceendlinenumber="335"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="335" sourceendlinenumber="335">Right-click on the <strong>Views</strong> folder in <strong>Solution Explorer</strong> and select Add ‣ New Folder</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="337" sourceendlinenumber="337"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="337" sourceendlinenumber="337">Enter <strong>Blogs</strong> as the name of the folder</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="339" sourceendlinenumber="339"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="339" sourceendlinenumber="339">Right-click on the <strong>Blogs</strong> folder and select Add ‣ New Item...</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="341" sourceendlinenumber="341"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="341" sourceendlinenumber="341">From the left menu select Installed ‣ ASP.NET</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="343" sourceendlinenumber="343"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="343" sourceendlinenumber="343">Select the <strong>MVC View Page</strong> item template</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="345" sourceendlinenumber="345"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="345" sourceendlinenumber="345">Enter <strong>Index.cshtml</strong> as the name and click <strong>Add</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="347" sourceendlinenumber="347"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="347" sourceendlinenumber="347">Replace the contents of the file with the following code</p>
</li>
</ul>
<!-- [!code-html[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Views/Blogs/Index.cshtml)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="350" sourceendlinenumber="381"><code class="lang-html">@model IEnumerable&lt;EFGetStarted.AspNetCore.ExistingDb.Models.Blog&gt;

@{
    ViewBag.Title = &quot;Blogs&quot;;
}

&lt;h2&gt;Blogs&lt;/h2&gt;

&lt;p&gt;
    &lt;a asp-controller=&quot;Blogs&quot; asp-action=&quot;Create&quot;&gt;Create New&lt;/a&gt;
&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
    &lt;tr&gt;
        &lt;th&gt;Id&lt;/th&gt;
        &lt;th&gt;Url&lt;/th&gt;
    &lt;/tr&gt;

    @foreach (var item in Model)
    {
        &lt;tr&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.BlogId)
            &lt;/td&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.Url)
            &lt;/td&gt;
        &lt;/tr&gt;
    }
&lt;/table&gt;
</code></pre><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="383" sourceendlinenumber="383">We&#39;ll also add a view for the <code>Create</code> action, which allows the user to enter details for a new blog.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="385" sourceendlinenumber="393">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="385" sourceendlinenumber="385"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="385" sourceendlinenumber="385">Right-click on the <strong>Blogs</strong> folder and select Add ‣ New Item...</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="387" sourceendlinenumber="387"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="387" sourceendlinenumber="387">From the left menu select Installed ‣ ASP.NET</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="389" sourceendlinenumber="389"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="389" sourceendlinenumber="389">Select the <strong>MVC View Page</strong> item template</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="391" sourceendlinenumber="391"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="391" sourceendlinenumber="391">Enter <strong>Create.cshtml</strong> as the name and click <strong>Add</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="393" sourceendlinenumber="393"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="393" sourceendlinenumber="393">Replace the contents of the file with the following code</p>
</li>
</ul>
<!-- [!code-html[Main](samples/Platforms/AspNetCore/AspNetCore.ExistingDb/Views/Blogs/Create.cshtml)] -->
<pre sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="396" sourceendlinenumber="422"><code class="lang-html">@model EFGetStarted.AspNetCore.ExistingDb.Models.Blog

@{
    ViewBag.Title = &quot;New Blog&quot;;
}

&lt;h2&gt;@ViewData[&quot;Title&quot;]&lt;/h2&gt;

&lt;form asp-controller=&quot;Blogs&quot; asp-action=&quot;Create&quot; method=&quot;post&quot; class=&quot;form-horizontal&quot; role=&quot;form&quot;&gt;
    &lt;div class=&quot;form-horizontal&quot;&gt;
        &lt;div asp-validation-summary=&quot;All&quot; class=&quot;text-danger&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;form-group&quot;&gt;
            &lt;label asp-for=&quot;Url&quot; class=&quot;col-md-2 control-label&quot;&gt;&lt;/label&gt;
            &lt;div class=&quot;col-md-10&quot;&gt;
                &lt;input asp-for=&quot;Url&quot; class=&quot;form-control&quot; /&gt;
                &lt;span asp-validation-for=&quot;Url&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;form-group&quot;&gt;
            &lt;div class=&quot;col-md-offset-2 col-md-10&quot;&gt;
                &lt;input type=&quot;submit&quot; value=&quot;Create&quot; class=&quot;btn btn-default&quot; /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/form&gt;
</code></pre><h2 id="run-the-application" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="424" sourceendlinenumber="424">Run the application</h2>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="426" sourceendlinenumber="426">You can now run the application to see it in action.</p>
<ul sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="428" sourceendlinenumber="436">
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="428" sourceendlinenumber="428"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="428" sourceendlinenumber="428">Debug ‣ Start Without Debugging</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="430" sourceendlinenumber="430"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="430" sourceendlinenumber="430">The application will build and open in a web browser</p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="432" sourceendlinenumber="432"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="432" sourceendlinenumber="432">Navigate to <strong>/Blogs</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="434" sourceendlinenumber="434"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="434" sourceendlinenumber="434">Click <strong>Create New</strong></p>
</li>
<li sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="436" sourceendlinenumber="436"><p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="436" sourceendlinenumber="436">Enter a <strong>Url</strong> for the new blog and click <strong>Create</strong></p>
</li>
</ul>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="438" sourceendlinenumber="438"><img src="_static/create.png" alt="image" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="438" sourceendlinenumber="438"></p>
<p sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="440" sourceendlinenumber="440"><img src="_static/index-existing-db.png" alt="image" sourcefile="platforms/aspnetcore/existing-db.md" sourcestartlinenumber="440" sourceendlinenumber="440"></p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/shirhatti/EntityFramework.Docs/blob/export-qa-fixes/ef/platforms/aspnetcore/existing-db.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
